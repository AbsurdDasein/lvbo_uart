# UART滤波控制功能说明

## 功能概述

本项目新增了通过UART串口控制图像滤波开关的功能。用户可以通过发送串口命令来实时控制是否启用3×3均值滤波，实现原实时图像和滤波后图像的切换显示。

## 硬件连接

- **UART接口**: 支持460800-8-N-1配置
- **RX引脚**: `uart_rx_i` (GPIOT_N_16)
- **TX引脚**: `uart_tx_o` (GPIOT_P_16)

## 支持的命令

### 1. 打开滤波
- **命令**: `filter_on`
- **功能**: 启用3×3均值滤波，显示滤波后的图像
- **响应**: `A` (ASCII 0x41) - 表示"already_on"

### 2. 关闭滤波  
- **命令**: `filter_off`
- **功能**: 关闭滤波，显示原始实时图像
- **响应**: `B` (ASCII 0x42) - 表示"already_off"

### 3. 未知命令
- **响应**: `U` (ASCII 0x43) - 表示"unknown command"

## 使用方法

### 串口配置
- 波特率: 460800
- 数据位: 8
- 停止位: 1  
- 校验位: 无
- 流控制: 无

### 命令发送
1. 打开串口终端工具（如PuTTY、SecureCRT等）
2. 配置串口参数为460800-8-N-1
3. 发送命令字符串，以回车(0x0D)或换行(0x0A)结束
4. 系统会立即返回响应字符

### 示例操作
```
发送: filter_on
响应: A

发送: filter_off  
响应: B

发送: unknown_cmd
响应: U
```

## 技术实现

### 模块结构
- `uart_cmd_parser.v`: 主控制模块
  - UART接收模块 (`uart_rx`)
  - UART发送模块 (`uart_tx`) 
  - 命令解析状态机
  - 滤波控制逻辑

### 数据流控制
- 滤波开启时: `MIPI CSI → Bayer2RGB → 白平衡 → 3×3均值滤波 → DDR → 显示`
- 滤波关闭时: `MIPI CSI → Bayer2RGB → 白平衡 → DDR → 显示`

### 关键信号
- `filter_enable`: 滤波使能信号
- `filter_status_changed`: 滤波状态变化标志
- 数据选择逻辑: `w_filter_enable ? 滤波数据 : 原始数据`

## 注意事项

1. **命令格式**: 命令必须完整发送，区分大小写
2. **超时机制**: 命令接收超时时间为100,000个时钟周期
3. **缓冲区**: 最大命令长度为10字节
4. **实时性**: 滤波开关切换立即生效，无需重启
5. **状态保持**: 滤波状态在系统运行期间保持，复位后默认为关闭状态

## 故障排除

### 常见问题
1. **无响应**: 检查串口配置和连接
2. **响应错误**: 确认命令拼写正确
3. **切换无效**: 检查系统时钟和复位信号

### 调试方法
- 使用示波器检查UART信号
- 通过LED指示灯观察系统状态
- 检查时钟域同步问题

## 扩展功能

未来可以扩展支持更多命令：
- 滤波参数调整
- 图像参数设置
- 系统状态查询
- 其他图像处理算法开关

